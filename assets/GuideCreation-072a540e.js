import{r as l,u as A,b as F,j as s,a as t,Q as o}from"./index-113eb709.js";import{a as d}from"./axios-439bb627.js";const k=()=>{const[g,p]=l.useState(1),[i,c]=l.useState({name:"",description:"",language:"en",storageAccountId:""}),[h,v]=l.useState([]),[b,u]=l.useState(""),[n,f]=l.useState(null),[w,x]=l.useState([]);A();const y=F();l.useEffect(()=>{(async()=>{try{const e=await d.get("http://localhost:3001/api/storage/accounts",{withCredentials:!0});x(e.data.storageAccounts)}catch(e){console.error("Error fetching storage accounts:",e),o.error("Failed to fetch storage accounts.")}})()},[]),l.useEffect(()=>{const e=new URLSearchParams(y.search).get("guideId");e&&(async()=>{try{const r=await d.get(`http://localhost:3001/api/guides/${e}`,{withCredentials:!0});c({name:r.data.guide.name,description:r.data.guide.description,language:r.data.guide.language,storageAccountId:r.data.guide.storageAccountId}),f(e),p(2)}catch(r){console.error("Error fetching guide info:",r),o.error("Failed to fetch guide information.")}})()},[y.search]);const N=()=>p(g-1),S=async a=>{a.preventDefault();try{let e;n?(e=await d.put(`http://localhost:3001/api/guides/${n}`,i,{withCredentials:!0}),o.success("Guide updated successfully. Now upload files.")):(e=await d.post("http://localhost:3001/api/guides",i,{withCredentials:!0}),o.success("Guide created successfully. Now upload files."),f(e.data.guideId)),p(2)}catch(e){console.error("Error creating/updating guide:",e),e.response&&e.response.data&&e.response.data.error?o.error(e.response.data.error):o.error("Error creating/updating guide.")}},G=a=>{v([...a.target.files])},C=async a=>{if(a.preventDefault(),!n)return o.error("Guide ID is missing.");if(h.length===0)return o.warn("Please select file(s).");for(let e of h){const m=new FormData;m.append("file",e);try{u(`Uploading ${e.name}...`),await d.post(`http://localhost:3001/api/files/upload?guideId=${n}`,m,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}}),u(`Successfully uploaded ${e.name}.`),o.success(`${e.name} uploaded successfully.`)}catch(r){console.error(`Error uploading ${e.name}:`,r),u(`Upload failed for ${e.name}.`),r.response&&r.response.data&&r.response.data.error?o.error(r.response.data.error):o.error(`Failed to upload ${e.name}.`)}}u("All files processed.")};return s("div",{className:"p-8",children:[t("h2",{className:"text-2xl mb-6",children:n?"Edit Guide":"Guide Creation Wizard"}),g===1&&s("form",{onSubmit:S,className:"mb-8",children:[s("div",{className:"mb-4",children:[t("label",{htmlFor:"name",className:"block text-gray-700 font-medium mb-1",children:"Guide Name:"}),t("input",{type:"text",id:"name",placeholder:"Guide Name",value:i.name,onChange:a=>c({...i,name:a.target.value}),className:"border p-2 mb-2 block w-full rounded",required:!0,"aria-label":"Guide Name"})]}),s("div",{className:"mb-4",children:[t("label",{htmlFor:"description",className:"block text-gray-700 font-medium mb-1",children:"Guide Description:"}),t("textarea",{id:"description",placeholder:"Guide Description",value:i.description,onChange:a=>c({...i,description:a.target.value}),className:"border p-2 mb-2 block w-full rounded",required:!0,"aria-label":"Guide Description"})]}),s("div",{className:"mb-4",children:[t("label",{htmlFor:"language",className:"block text-gray-700 font-medium mb-1",children:"Language:"}),s("select",{id:"language",value:i.language,onChange:a=>c({...i,language:a.target.value}),className:"border p-2 mb-2 w-full rounded","aria-label":"Language Selection",children:[t("option",{value:"en",children:"English"}),t("option",{value:"sv",children:"Swedish"})]})]}),s("div",{className:"mb-4",children:[t("label",{htmlFor:"storageAccount",className:"block text-gray-700 font-medium mb-1",children:"Select Storage Account:"}),s("select",{id:"storageAccount",value:i.storageAccountId,onChange:a=>c({...i,storageAccountId:a.target.value}),className:"border p-2 mb-2 w-full rounded",required:!0,"aria-label":"Storage Account Selection",children:[t("option",{value:"",children:"-- Select Storage Account --"}),w.map(a=>s("option",{value:a.id,children:[a.storage_type.toUpperCase()," - ",a.account_name]},a.id))]})]}),s("div",{className:"flex justify-between",children:[t("button",{type:"button",onClick:N,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition duration-200",children:"Back"}),t("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-200",children:n?"Update Guide":"Next: Upload Files"})]})]}),g===2&&s("div",{className:"mb-8",children:[t("h3",{className:"text-lg mb-2",children:"Upload Files"}),s("form",{onSubmit:C,className:"mb-4",children:[t("input",{type:"file",multiple:!0,onChange:G,className:"mb-2 w-full",required:!0,"aria-label":"Upload Files"}),t("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-200",children:"Upload Files"})]}),b&&t("p",{className:"mb-2",children:b}),t("button",{onClick:N,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition duration-200",children:"Back"})]})]})};export{k as default};
